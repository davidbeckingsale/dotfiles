---
- hosts: localhost
  vars:
    ansible_python_interpreter: /opt/homebrew/bin/python3
  roles:
    - role: elliotweiser.osx-command-line-tools
  tasks:
    - import_tasks: tasks/homebrew.yml
    - name: 'install zprezto'
      shell: git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"
      args:
        creates: "/Users/{{ lookup('env', 'USER') }}/.zprezto"
    - name: 'find configs'
      find:
        paths: '{{ playbook_dir }}/config/'
        depth: 2
        recurse: yes
      register: configs
    - name: 'install config symlinks'
      file:
        src: "{{ item.path }}"
        path: "~/.{{ item.path | basename }}"
        state: link
        force: yes
      with_items: "{{ configs.files }}"
    - name: Install VSCode extensions
      shell: code-insiders --install-extension {{ item }}
      with_items:
        - vscodevim.vim
        - ms-vscode.cpptools
        - twxs.cmake
        - ms-vscode.cmake-tools
        - ms-vscode-remote.remote-ssh
